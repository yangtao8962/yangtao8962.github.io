<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>安装常用服务 | Tao&#39;s Docs</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.eb84dcc4.js" as="script"><link rel="preload" href="/assets/js/2.3438093d.js" as="script"><link rel="preload" href="/assets/js/39.8ca4953b.js" as="script"><link rel="prefetch" href="/assets/js/10.5c85d835.js"><link rel="prefetch" href="/assets/js/11.4e188f36.js"><link rel="prefetch" href="/assets/js/12.63bafc7d.js"><link rel="prefetch" href="/assets/js/13.b4785702.js"><link rel="prefetch" href="/assets/js/14.f812d107.js"><link rel="prefetch" href="/assets/js/15.9292f8a4.js"><link rel="prefetch" href="/assets/js/16.c1fe50c7.js"><link rel="prefetch" href="/assets/js/17.b8c322d0.js"><link rel="prefetch" href="/assets/js/18.9d5b497f.js"><link rel="prefetch" href="/assets/js/19.02d9dbde.js"><link rel="prefetch" href="/assets/js/20.d41d055a.js"><link rel="prefetch" href="/assets/js/21.e546c67d.js"><link rel="prefetch" href="/assets/js/22.88d5c441.js"><link rel="prefetch" href="/assets/js/23.52b19eba.js"><link rel="prefetch" href="/assets/js/24.7cfd8490.js"><link rel="prefetch" href="/assets/js/25.b634aa65.js"><link rel="prefetch" href="/assets/js/26.e6adb331.js"><link rel="prefetch" href="/assets/js/27.0d5b7487.js"><link rel="prefetch" href="/assets/js/28.38896ef3.js"><link rel="prefetch" href="/assets/js/29.0d8a4197.js"><link rel="prefetch" href="/assets/js/3.1d9e5fa9.js"><link rel="prefetch" href="/assets/js/30.a6742e17.js"><link rel="prefetch" href="/assets/js/31.abc42197.js"><link rel="prefetch" href="/assets/js/32.a0586ff7.js"><link rel="prefetch" href="/assets/js/33.769cdb65.js"><link rel="prefetch" href="/assets/js/34.0ed6a7b5.js"><link rel="prefetch" href="/assets/js/35.05027a7e.js"><link rel="prefetch" href="/assets/js/36.9fe4cab0.js"><link rel="prefetch" href="/assets/js/37.f55cbcbb.js"><link rel="prefetch" href="/assets/js/38.9917a028.js"><link rel="prefetch" href="/assets/js/4.b7d0708f.js"><link rel="prefetch" href="/assets/js/40.be762125.js"><link rel="prefetch" href="/assets/js/41.26af46d4.js"><link rel="prefetch" href="/assets/js/42.ee5b090a.js"><link rel="prefetch" href="/assets/js/43.336503df.js"><link rel="prefetch" href="/assets/js/44.dc926be6.js"><link rel="prefetch" href="/assets/js/45.6854943b.js"><link rel="prefetch" href="/assets/js/46.8e0d341a.js"><link rel="prefetch" href="/assets/js/47.f2e48103.js"><link rel="prefetch" href="/assets/js/48.72715128.js"><link rel="prefetch" href="/assets/js/49.44639b54.js"><link rel="prefetch" href="/assets/js/5.9e2f4ca7.js"><link rel="prefetch" href="/assets/js/50.6bcef58f.js"><link rel="prefetch" href="/assets/js/51.a78f9b9f.js"><link rel="prefetch" href="/assets/js/52.7fa6c2a6.js"><link rel="prefetch" href="/assets/js/53.72d89890.js"><link rel="prefetch" href="/assets/js/54.9ee5a5d0.js"><link rel="prefetch" href="/assets/js/55.d39bc266.js"><link rel="prefetch" href="/assets/js/56.57eec7c3.js"><link rel="prefetch" href="/assets/js/57.759b950d.js"><link rel="prefetch" href="/assets/js/58.dba62ed6.js"><link rel="prefetch" href="/assets/js/59.b381d76a.js"><link rel="prefetch" href="/assets/js/6.c7b54f12.js"><link rel="prefetch" href="/assets/js/60.47666c3f.js"><link rel="prefetch" href="/assets/js/61.5f20b3e7.js"><link rel="prefetch" href="/assets/js/62.edaf0b01.js"><link rel="prefetch" href="/assets/js/63.101ed616.js"><link rel="prefetch" href="/assets/js/64.e81ca07d.js"><link rel="prefetch" href="/assets/js/65.eef3caa6.js"><link rel="prefetch" href="/assets/js/66.47e25e41.js"><link rel="prefetch" href="/assets/js/67.f61b31d4.js"><link rel="prefetch" href="/assets/js/68.d58f06f4.js"><link rel="prefetch" href="/assets/js/69.de63cbe4.js"><link rel="prefetch" href="/assets/js/7.f39602d3.js"><link rel="prefetch" href="/assets/js/70.e55a4ab9.js"><link rel="prefetch" href="/assets/js/71.340f0f17.js"><link rel="prefetch" href="/assets/js/72.efc7adcb.js"><link rel="prefetch" href="/assets/js/8.f49bd070.js"><link rel="prefetch" href="/assets/js/9.9ddd43a0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Tao's Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/back-end/introduction.html" class="nav-link">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/pages/database/introduction.html" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/pages/tools/introduction.html" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/pages/dev-env/introduction.html" class="nav-link">
  环境搭建
</a></li></ul></div></div><div class="nav-item"><a href="https://yangtao.live/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客主页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow down"></span></button> <button type="button" aria-label="分类" class="mobile-dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/back-end/introduction.html" class="nav-link">
  后端
</a></li><li class="dropdown-item"><!----> <a href="/pages/database/introduction.html" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/pages/tools/introduction.html" class="nav-link">
  工具
</a></li><li class="dropdown-item"><!----> <a href="/pages/dev-env/introduction.html" class="nav-link">
  环境搭建
</a></li></ul></div></div><div class="nav-item"><a href="https://yangtao.live/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客主页
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>页面介绍</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Maven</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Rabbit MQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Docker</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/tools/docker-1-introduction.html" class="sidebar-link">简介</a></li><li><a href="/pages/tools/docker-2-install.html" class="sidebar-link">安装</a></li><li><a href="/pages/tools/docker-3-framework.html" class="sidebar-link">架构</a></li><li><a href="/pages/tools/docker-4-configuration.html" class="sidebar-link">配置</a></li><li><a href="/pages/tools/docker-5-commands.html" class="sidebar-link">常用命令</a></li><li><a href="/pages/tools/docker-6-image.html" class="sidebar-link">镜像原理</a></li><li><a href="/pages/tools/docker-7-network.html" class="sidebar-link">网络通信</a></li><li><a href="/pages/tools/docker-8-volume.html" class="sidebar-link">数据卷</a></li><li><a href="/pages/tools/docker-9-software.html" aria-current="page" class="active sidebar-link">常用软件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/tools/docker-9-software.html#安装常用服务" class="sidebar-link">安装常用服务</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/tools/docker-9-software.html#mysql-5-7" class="sidebar-link">MySQL 5.7</a></li><li class="sidebar-sub-header"><a href="/pages/tools/docker-9-software.html#tomcat8-5-68-jdk8" class="sidebar-link">Tomcat8.5.68-jdk8</a></li><li class="sidebar-sub-header"><a href="/pages/tools/docker-9-software.html#redis-5-0-10" class="sidebar-link">Redis 5.0.10</a></li></ul></li></ul></li><li><a href="/pages/tools/docker-10-dockerfile.html" class="sidebar-link">dockerfile</a></li><li><a href="/pages/tools/docker-11-compose.html" class="sidebar-link">docker-compose</a></li><li><a href="/pages/tools/docker-12-portainer.html" class="sidebar-link">可视化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="安装常用服务"><a href="#安装常用服务" class="header-anchor">#</a> 安装常用服务</h2> <p>DockerHub库 https://hub.docker.com/，注意Tags和Description中的 How to use this image</p> <h3 id="mysql-5-7"><a href="#mysql-5-7" class="header-anchor">#</a> MySQL 5.7</h3> <h5 id="拉取镜像"><a href="#拉取镜像" class="header-anchor">#</a> 拉取镜像</h5> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> pull mysql:5.7.34
</code></pre></div><h5 id="配置密码并启动"><a href="#配置密码并启动" class="header-anchor">#</a> 配置密码并启动</h5> <blockquote><p>Starting a MySQL instance is simple:</p> <div class="language-console extra-class"><pre class="language-text"><code>$ docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag
</code></pre></div><p>... where <code>some-mysql</code> is the name you want to assign to your container, <code>my-secret-pw</code> is the password to be set for the MySQL root user and <code>tag</code> is the tag specifying the MySQL version you want. See the list above for relevant tags.</p></blockquote> <p><code>-e MYSQL_ROOT_PASSWORD=root</code> ：给root用户指定密码</p> <p>启动一个mysql服务，后台运行，指定root用户密码，指定容器名字</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">3306</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root --name mysql mysql:5.7.34
</code></pre></div><p><img src="https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002703159.png" alt=""></p> <p>之后就可以使用3306端口和主机号登录了。</p> <h5 id="配置数据持久化-数据卷"><a href="#配置数据持久化-数据卷" class="header-anchor">#</a> 配置数据持久化（数据卷）</h5> <blockquote><p>Where to Store Data</p> <p>Important note: There are several ways to store data used by applications that run in Docker containers. We encourage users of the <code>mysql</code> images to familiarize themselves with the options available, including:</p> <ul><li>Let Docker manage the storage of your database data <a href="https://docs.docker.com/engine/tutorials/dockervolumes/#adding-a-data-volume" target="_blank" rel="noopener noreferrer">by writing the database files to disk on the host system using its own internal volume management<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This is the default and is easy and fairly transparent to the user. The downside is that the files may be hard to locate for tools and applications that run directly on the host system, i.e. outside containers.</li> <li>Create a data directory on the host system (outside the container) and <a href="https://docs.docker.com/engine/tutorials/dockervolumes/#mount-a-host-directory-as-a-data-volume" target="_blank" rel="noopener noreferrer">mount this to a directory visible from inside the container<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This places the database files in a known location on the host system, and makes it easy for tools and applications on the host system to access the files. The downside is that the user needs to make sure that the directory exists, and that e.g. directory permissions and other security mechanisms on the host system are set up correctly.</li></ul> <p>The Docker documentation is a good starting point for understanding the different storage options and variations, and there are multiple blogs and forum postings that discuss and give advice in this area. We will simply show the basic procedure here for the latter option above:</p> <ol><li><p>Create a data directory on a suitable volume on your host system, e.g. <code>/my/own/datadir</code>.</p></li> <li><p>Start your <code>mysql</code> container like this:</p> <div class="language-console extra-class"><pre class="language-text"><code>$ docker run --name some-mysql -v /my/own/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag
</code></pre></div></li></ol> <p>The <code>-v /my/own/datadir:/var/lib/mysql</code> part of the command mounts the <code>/my/own/datadir</code> directory from the underlying host system as <code>/var/lib/mysql</code> inside the container, where MySQL by default will write its data files.</p></blockquote> <p>通过官方文档得知该镜像创建的容器将mysql 的数据存放在 <code>/var/lib/mysql</code>目录下</p> <p>配置数据卷</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">3306</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root --name mysql -v mysqldata:/var/lib/mysql mysql:5.7.34
</code></pre></div><p><img src="https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002714492.png" alt=""></p> <p>使用Navicat Premium连接并新建一个数据库</p> <p><img src="https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002722797.png" alt=""></p> <p><img src="https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002728025.png" alt=""></p> <p>新建后可看到数据库已持久化到宿主机</p> <p><code>验证</code></p> <p>此时我们再次创建一个mysql镜像，使用3307端口，命名为mysql_3307，数据卷配置同样是mysqldata</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">3307</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root --name mysql_3307 -v mysqldata:/var/lib/mysql mysql:5.7.34
</code></pre></div><p>创建成功后使用软件连接</p> <p><img src="https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002740465.png" alt=""></p> <p>可以看到由于 <code>/var/lib/docker/volumes/mysqldata/_data</code>中存有test数据库，因此新的镜像配置数据卷、连接后也有数据库test</p> <p><img src="https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002748439.png" alt=""></p> <h5 id="配置文件映射到本地"><a href="#配置文件映射到本地" class="header-anchor">#</a> 配置文件映射到本地</h5> <p>启动一个mysql服务，后台运行，指定root用户密码，指定容器名字，使用数据卷进行数据持久化，并将配置文件映射到宿主机的某个文件</p> <blockquote><p>Using a custom MySQL configuration file</p> <p>The default configuration for MySQL can be found in <code>/etc/mysql/my.cnf</code>, which may <code>!includedir</code> additional directories such as <code>/etc/mysql/conf.d</code> or <code>/etc/mysql/mysql.conf.d</code>. Please inspect the relevant files and directories within the <code>mysql</code> image itself for more details.</p> <p>If <code>/my/custom/config-file.cnf</code> is the path and name of your custom configuration file, you can start your <code>mysql</code> container like this (note that only the directory path of the custom config file is used in this command):</p> <div class="language-console extra-class"><pre class="language-text"><code>$ docker run --name some-mysql -v /my/custom:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag
</code></pre></div><p>This will start a new container <code>some-mysql</code> where the MySQL instance uses the combined startup settings from <code>/etc/mysql/my.cnf</code> and <code>/etc/mysql/conf.d/config-file.cnf</code>, with settings from the latter taking precedence.</p></blockquote> <p>由官方文档可知，mysql的配置文件在容器内的 <code>/etc/mysql</code>目录下，我们可以将这个目录与主机的目录进行映射</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">3306</span>:3306 -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root --name mysql_3306 -v mysqldata:/var/lib/mysql -v mysqlconfig:/etc/mysql mysql:5.7.34
</code></pre></div><p><img src="https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002759936.png" alt=""></p> <p>以后要修改配置文件，就直接修改宿主机<code>/var/lib/docker/volumes/mysqlconfig/_data</code>目录下的配置文件就行了。</p> <h3 id="tomcat8-5-68-jdk8"><a href="#tomcat8-5-68-jdk8" class="header-anchor">#</a> Tomcat8.5.68-jdk8</h3> <h5 id="拉取镜像-2"><a href="#拉取镜像-2" class="header-anchor">#</a> 拉取镜像</h5> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> pull tomcat:8.5.68-jdk8
</code></pre></div><h5 id="映射webapps"><a href="#映射webapps" class="header-anchor">#</a> 映射webapps</h5> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">8081</span>:8080 --name tomcat8 -v tomcat8_webapps:/usr/local/tomcat/webapps tomcat:8.5.68-jdk8
</code></pre></div><p><img src="https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002813717.png" alt=""></p> <p>访问：</p> <p><img src="https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002837157.png" alt=""></p> <h5 id="映射配置文件-webapps"><a href="#映射配置文件-webapps" class="header-anchor">#</a> 映射配置文件+webapps</h5> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">8081</span>:8080 --name tomcat8 -v tomcat8_webapps:/usr/local/tomcat/webapps -v tomcat8_confs:/usr/local/tomcat/conf tomcat:8.5.68-jdk8
</code></pre></div><p>注意：在修改端口后，由于容器启动的命令是不能修改的，即宿主机端口映射的始终都是启动容器时配置的端口，导致宿主机端口无法映射到tomcat新端口，无法使用。</p> <p>==万无一失：在修改完配置文件后，直接重启一个新的容器==</p> <h3 id="redis-5-0-10"><a href="#redis-5-0-10" class="header-anchor">#</a> Redis 5.0.10</h3> <h5 id="拉取镜像-3"><a href="#拉取镜像-3" class="header-anchor">#</a> 拉取镜像</h5> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> pull redis:5.0.10
</code></pre></div><h5 id="启动"><a href="#启动" class="header-anchor">#</a> 启动</h5> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">6379</span>:6379 --name redis redis:5.0.10
</code></pre></div><h5 id="开启redis持久化"><a href="#开启redis持久化" class="header-anchor">#</a> 开启redis持久化</h5> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">6379</span>:6379 --name redis redis:5.0.10 redis-server --appendonly <span class="token function">yes</span>
</code></pre></div><blockquote><p>start with persistent storage</p> <div class="language-console extra-class"><pre class="language-text"><code>$ docker run --name some-redis -d redis redis-server --appendonly yes
</code></pre></div><p>If persistence is enabled, data is stored in the <code>VOLUME /data</code>, which can be used with <code>--volumes-from some-volume-container</code> or <code>-v /docker/host/dir:/data</code> (see <a href="https://docs.docker.com/engine/tutorials/dockervolumes/" target="_blank" rel="noopener noreferrer">docs.docker volumes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>).</p> <p>For more about Redis Persistence, see http://redis.io/topics/persistence.</p></blockquote> <p>开启持久化之后，持久化生成的aof文件会被放入容器 <code>/data</code>目录中</p> <p>所以完整的命令为</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">6379</span>:6379 -v redisdata:/data --name redis redis:5.0.10 redis-server --appendonly <span class="token function">yes</span>
</code></pre></div><h5 id="自定义redis配置文件"><a href="#自定义redis配置文件" class="header-anchor">#</a> 自定义redis配置文件</h5> <blockquote><p>Additionally, If you want to use your own redis.conf ...</p> <p>You can create your own Dockerfile that adds a redis.conf from the context into /data/, like so.</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> redis</span>
<span class="token instruction"><span class="token keyword">COPY</span> redis.conf /usr/local/etc/redis/redis.conf</span>
<span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">&quot;redis-server&quot;</span>, <span class="token string">&quot;/usr/local/etc/redis/redis.conf&quot;</span> ]</span>
</code></pre></div><p>Alternatively, you can specify something along the same lines with <code>docker run</code> options.</p> <div class="language-console extra-class"><pre class="language-text"><code>$ docker run -v /myredis/conf:/usr/local/etc/redis --name myredis redis redis-server /usr/local/etc/redis/redis.conf
</code></pre></div><p>Where <code>/myredis/conf/</code> is a local directory containing your <code>redis.conf</code> file. Using this method means that there is no need for you to have a Dockerfile for your redis container.</p> <p>The mapped directory should be writable, as depending on the configuration and mode of operation, Redis may need to create additional configuration files or rewrite existing ones.</p></blockquote> <p>官网下载redis对应的配置文件 redis.conf，放置在宿主机中，注意修改配置文件中 <code>bind 0.0.0.0</code>，之后将这个配置文件所在的目录映射到容器中的 <code>/usr/local/etc/redis</code>目录下，通过命令启动</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run -d -p <span class="token number">6379</span>:6379 -v /root/redisconf:/usr/local/etc/redis --name redis redis:5.0.10 redis-server /usr/local/etc/redis/redis.conf
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/tools/docker-8-volume.html" class="prev">
        数据卷
      </a></span> <span class="next"><a href="/pages/tools/docker-10-dockerfile.html">
        dockerfile
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.eb84dcc4.js" defer></script><script src="/assets/js/2.3438093d.js" defer></script><script src="/assets/js/39.8ca4953b.js" defer></script>
  </body>
</html>
