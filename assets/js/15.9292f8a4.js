(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{413:function(t,a,s){"use strict";s.r(a);var n=s(56),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"配置中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置中心"}},[t._v("#")]),t._v(" 配置中心")]),t._v(" "),s("h3",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("config（配置）又称为"),s("strong",[t._v("统一配置中心")]),t._v("。Spring基于Netflix Config进行二次封装而来。顾名思义，就是"),s("strong",[t._v("将配置统一管理（托管到远程仓库）")]),t._v("，配置统一管理的好处是在日后大规模集群部署服务应用时"),s("strong",[t._v("使相同的服务配置一致")]),t._v("，日后再修改配置只需要"),s("strong",[t._v("统一修改")]),t._v("全部同步，"),s("strong",[t._v("无需一个一个服务手动维护")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"图示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图示"}},[t._v("#")]),t._v(" 图示")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220124204121066.png",alt:"image-20220124204121066"}})]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("服务端：配置所有的配置文件")])]),t._v(" "),s("li",[s("strong",[t._v("客户端：从服务端拉取配置文件进行配置")])])]),t._v(" "),s("h2",{attrs:{id:"config"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#config"}},[t._v("#")]),t._v(" Config")]),t._v(" "),s("h3",{attrs:{id:"前置准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前置准备"}},[t._v("#")]),t._v(" 前置准备")]),t._v(" "),s("p",[t._v("首先需要准备一个远程git仓库，用于保存配置文件")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220124212625044.png",alt:"image-20220124212625044"}})]),t._v(" "),s("h3",{attrs:{id:"config-server开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#config-server开发"}},[t._v("#")]),t._v(" Config Server开发")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("快速构建一个SpringBoot项目，加入服务注册中心，指定端口为6666，服务名为CONFIGSERVER，这一步很重要，等会需要config client指定config server")])]),t._v(" "),s("li",[s("p",[t._v("引入依赖")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-config-server"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("配置远程仓库的地址")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.config.server.git.uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("https://gitee.com/yangtao8453/springcloud-config")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.config.server.default-label")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("master")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 私有库需配置用户名和密码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# spring.cloud.config.server.git.username=")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# spring.cloud.config.server.git.password=")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("入口类开启统一配置中心")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@SpringBootApplication")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@EnableConfigServer")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConfigServerApplication")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("将配置文件提交到远程仓库中，依次为：configclient.properties、configclient-dev.properties、configclient-pro.properties")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server.port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2333")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.application.name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("CONFIGCLIENT")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.consul.port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("8500")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.consul.host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("localhost")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.profiles.active")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("dev")]),t._v("\n")])])]),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("dev")]),t._v("\n")])])]),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("pro")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("访问"),s("a",{attrs:{href:"http://localhost:7999/configclient-xx.properties",target:"_blank",rel:"noopener noreferrer"}},[t._v("localhost:7999/configclient-xx.properties"),s("OutboundLink")],1),t._v("，获取到的配置信息为")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220125234747030.png",alt:"image-20220125234747030"}})])]),t._v(" "),s("li",[s("p",[t._v("原因："),s("strong",[t._v("访问的configclient-xx.properties文件不存在，因此会拉取默认的configclient.properties")])])]),t._v(" "),s("li",[s("p",[t._v("当访问的配置"),s("strong",[t._v("文件存在时，会将该文件与configclient.properties合并返回")]),t._v("，如访问："),s("a",{attrs:{href:"http://localhost:7999/configclient-dev.properties",target:"_blank",rel:"noopener noreferrer"}},[t._v("localhost:7999/configclient-dev.properties"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220125234925078.png",alt:"image-20220125234925078"}})])]),t._v(" "),s("li",[s("p",[t._v("拉取后会在"),s("strong",[t._v("本地缓存")]),t._v("一份配置文件")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220125235211955.png",alt:"image-20220125235211955"}})])])]),t._v(" "),s("h3",{attrs:{id:"config-client"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#config-client"}},[t._v("#")]),t._v(" Config Client")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("快速构建一个SpringBoot项目，接入服务注册中心，指定端口号为2333")])]),t._v(" "),s("li",[s("p",[t._v("引入依赖")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-config"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("配置文件，指定config server的地址、注册中心的地址、需要的配置文件")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前configclient统一配置中心在注册中心的服务id")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当前configclient统一配置中心在注册中心的服务id")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.config.discovery.service-id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("CONFIGSERVER")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启config server发现")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.config.discovery.enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("true")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置注册中心")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.consul.host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("localhost")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.consul.port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("8500")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取哪个配置文件：1.分支；2.文件名；3.环境")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.config.label")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("master")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.config.name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("configclient")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("spring.cloud.config.profile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("dev")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("报错：默认从8888拉取配置文件")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220126001419784.png",alt:"image-20220126001419784"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220126001050015.png",alt:"image-20220126001050015"}})])]),t._v(" "),s("li",[s("p",[t._v("服务以当前的配置文件启动，启动不起来，"),s("strong",[t._v("应配置更高优先级的配置文件")]),t._v("，"),s("strong",[t._v("预先从config server拉取配置文件")]),t._v("，"),s("strong",[t._v("再以application.properties启动")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("将config client的配置文件命名为bootstrap.properties")]),t._v("，重新启动，可看到已拉取到配置文件")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220126002045851.png",alt:"image-20220126002045851"}})])]),t._v(" "),s("li",[s("p",[t._v("controller测试")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RestController")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${name}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"The env is "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("访问"),s("a",{attrs:{href:"http://localhost:2333/",target:"_blank",rel:"noopener noreferrer"}},[t._v("localhost:2333"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220126002302372.png",alt:"image-20220126002302372"}})])]),t._v(" "),s("li",[s("p",[t._v("以后如果想切换环境，直接修改config client的配置文件bootstrap.properties中的"),s("strong",[t._v("spring.cloud.config.profile")]),t._v("的值")])])]),t._v(" "),s("h3",{attrs:{id:"手动刷新配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动刷新配置"}},[t._v("#")]),t._v(" 手动刷新配置")]),t._v(" "),s("p",[t._v("以上情况中，如果远程仓库的配置文件发生改变，则本地的服务需要重启才能读取配置信息（缓存）。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("controller类上加入注解 "),s("strong",[t._v("@RefreshScope")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RestController")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RefreshScope")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${name}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"The env is "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("config client"),s("strong",[t._v("暴露远端配置端点")]),t._v("（bootstrap.properties中配置）")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("management.endpoints.web.exposure.include")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("*")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("修改完远程仓库的配置后，向config client发送一个post方式请求，访问："),s("a",{attrs:{href:"http://localhost:2333/actuator/refresh",target:"_blank",rel:"noopener noreferrer"}},[t._v("localhost:2333/actuator/refresh"),s("OutboundLink")],1),t._v("，返回值会告诉我们哪些信息发生了改变")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220126004707646.png",alt:"image-20220126004707646"}})])]),t._v(" "),s("li",[s("p",[t._v("虽然手动刷新配置不用重启服务，但还是要单独向每个服务发送post请求，服务集群主机一多还是很不方便。除了手动刷新配置，还有自动刷新配置，需配合BUS组件使用，下节再说。")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);