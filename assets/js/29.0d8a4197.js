(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{427:function(t,a,s){"use strict";s.r(a);var e=s(56),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[t._v("#")]),t._v(" Dockerfile")]),t._v(" "),s("h3",{attrs:{id:"什么是dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是dockerfile"}},[t._v("#")]),t._v(" 什么是Dockerfile")]),t._v(" "),s("p",[t._v("可以认为是"),s("code",[t._v("Docker镜像的描述文件")]),t._v("，是由一系列命令和参数构成的脚本，也成为"),s("code",[t._v("docker镜像的构建文件")]),t._v("。日后用户可以将自己的应用打包成镜像。")]),t._v(" "),s("h3",{attrs:{id:"解析过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解析过程"}},[t._v("#")]),t._v(" 解析过程")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002853730.png",alt:""}})]),t._v(" "),s("p",[t._v("加入命令"),s("code",[t._v("--no-cache")]),t._v("可以不使用缓存")]),t._v(" "),s("h3",{attrs:{id:"build构建镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#build构建镜像"}},[t._v("#")]),t._v(" build构建镜像")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" URL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" -\n\t--build-arg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":设置镜像创建时的变量；\n\t--cpu-shares:设置 cpu 使用权重；\n\t--cpu-period:限制 CPU CFS周期；\n\t--cpu-quota:限制 CPU CFS配额；\n\t--cpuset-cpus:指定使用的CPU id；\n\t--cpuset-mems:指定使用的内存 id；\n\t--disable-content-trust:忽略校验，默认开启；\n\t-f:指定要使用的Dockerfile路径；\n\t--force-rm:设置镜像过程中删除中间容器；\n\t--isolation:使用容器隔离技术；\n\t--label"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":设置镜像使用的元数据；\n\t-m :设置内存最大值；\n\t--memory-swap:设置Swap的最大值为内存+swap，"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-1"')]),t._v("表示不限swap；\n\t--no-cache:创建镜像的过程不使用缓存；\n\t--pull:尝试去更新镜像的新版本；\n\t--quiet, -q:安静模式，成功后只输出镜像 ID；\n\t--rm:设置镜像成功后删除中间容器；\n\t--shm-size:设置/dev/shm的大小，默认值是64M；\n\t--ulimit:Ulimit配置。\n\t--squash:将 Dockerfile 中所有的操作压缩为一层。\n\t--tag, -t:镜像的名字及标签，通常 name:tag 或者 name 格式；可以在一次构建中为一个镜像设置多个标签。\n\t--network:默认 default。在构建期间设置RUN指令的网络模式\n\t\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build -t mycentos7:v1 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build github.com/creack/docker-firefox\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用指定URL的Dockerfile")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build -f /root/MyDockerfiles/Dockerfile "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])])]),s("h3",{attrs:{id:"dockerfile语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile语法"}},[t._v("#")]),t._v(" Dockerfile语法")]),t._v(" "),s("p",[t._v("官方说明:https://docs.docker.com/engine/reference/builder/")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("保留字")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("FROM")])]),t._v(" "),s("td",[s("strong",[t._v("当前镜像是基于哪个镜像的")]),t._v(" "),s("code",[t._v("第一个指令必须是FROM")])])]),t._v(" "),s("tr",[s("td",[t._v("MAINTAINER")]),t._v(" "),s("td",[t._v("镜像维护者的姓名和邮箱地址")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("RUN")])]),t._v(" "),s("td",[s("strong",[t._v("构建镜像时需要运行的指令")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("EXPOSE")])]),t._v(" "),s("td",[s("strong",[t._v("当前容器对外暴露出的端口号")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("WORKDIR")])]),t._v(" "),s("td",[s("strong",[t._v("指定在创建容器后，终端默认登录进来的工作目录，一个落脚点")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("ENV")])]),t._v(" "),s("td",[s("strong",[t._v("用来在构建镜像过程中设置环境变量")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("ADD")])]),t._v(" "),s("td",[s("strong",[t._v("将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar包")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("COPY")])]),t._v(" "),s("td",[s("strong",[t._v("类似于ADD，拷贝文件和目录到镜像中"),s("br"),t._v("将从构建上下文目录中<原路径>的文件/目录复制到新的一层的镜像内的<目标路径>位置")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("VOLUME")])]),t._v(" "),s("td",[s("strong",[t._v("容器数据卷，用于数据保存和持久化工作")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("CMD")])]),t._v(" "),s("td",[s("strong",[t._v("指定一个容器启动时要运行的命令"),s("br"),t._v("Dockerfile中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换")])])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("ENTRYPOINT")])]),t._v(" "),s("td",[s("strong",[t._v("指定一个容器启动时要运行的命令"),s("br"),t._v("ENTRYPOINT的目的和CMD一样，都是在指定容器启动程序及其参数")])])])])]),t._v(" "),s("h5",{attrs:{id:"from命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#from命令"}},[t._v("#")]),t._v(" from命令")]),t._v(" "),s("p",[t._v("基于哪个镜像构建新的镜像，在构建时会自动从dockerhub拉取base镜像，必须作为Dockerfile的第一个指令出现")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" <image>")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" <image>[:<tag>]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" <image>[@<digest>]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" centos:7")]),t._v("\n")])])]),s("h5",{attrs:{id:"run命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#run命令"}},[t._v("#")]),t._v(" run命令")]),t._v(" "),s("p",[t._v("将在当前映像之上的新层中指定任何命令并提交结果，生成的提交映像将用于Dockerfile中的下一步")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" <command> (shell form, the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" echo hello")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"executable"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"param1"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"param2"')]),t._v("] (exec form)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/bash"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-c"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo hello"')]),t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("run")]),t._v(" yum install -y vim")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("run")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yum"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"install"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-y"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vim"')]),t._v("]")]),t._v("\n")])])]),s("h5",{attrs:{id:"expose命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#expose命令"}},[t._v("#")]),t._v(" expose命令")]),t._v(" "),s("p",[t._v("指定构建的镜像在运行容器时对外暴露的端口，暴露后运行容器时 "),s("code",[t._v("-p")]),t._v("指令才有效")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expose")]),t._v(" 80/tcp")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expose")]),t._v(" 8080/tcp")]),t._v("\n")])])]),s("h5",{attrs:{id:"workdir命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#workdir命令"}},[t._v("#")]),t._v(" workdir命令")]),t._v(" "),s("p",[t._v("用来为Dockerfile中的任何run、cmd、entrypoint、copy和add指令设置工作目录，如果workdir不存在，即使他没有在任何后续Dockerfile指令中使用，他也将被创建")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /path/to/workdir")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /a")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" b")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" c")]),t._v("\n`注意:WORKDIR指令可以在Dockerfile中多次使用。如果提供了相对路径，则该路径将与先前WORKDIR指令的路径相对`\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("workdir")]),t._v(" /data")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("workdir")]),t._v(" bb\t\t# 相对路径，相对于/data，即/data/bb")]),t._v("\n")])])]),s("h5",{attrs:{id:"copy命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#copy命令"}},[t._v("#")]),t._v(" copy命令")]),t._v(" "),s("p",[t._v("将context目录中指定文件复制到镜像的指定目录中")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" src dest")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<src>"')]),t._v(",... "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<dest>"')]),t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("copy")]),t._v(" aa.txt /data/bb\t# aa.txt是在Dockerfile所在的目录下的文件")]),t._v("\n")])])]),s("h5",{attrs:{id:"add命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#add命令"}},[t._v("#")]),t._v(" add命令")]),t._v(" "),s("p",[t._v("可以看作是增强版的copy指令，从context上下文中复制新文件、目录或远程文件url，并将它们添加到位于指定路径的映像文件系统中")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" hom* /mydir/       通配符添加多个文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" hom?.txt /mydir/   通配符添加")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" test.txt relativeDir/  可以指定相对路径")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" test.txt /absoluteDir/ 也可以指定绝对路径")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" url ")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add")]),t._v(" https://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-9/v9.0.50/bin/apache-tomcat-9.0.50.tar.gz /data/bb \t# 会将tomcat9下载到/dta/bb目录下")]),t._v("\n")])])]),s("h5",{attrs:{id:"volume命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#volume命令"}},[t._v("#")]),t._v(" volume命令")]),t._v(" "),s("p",[t._v("用来定义容器运行时可以挂载到宿主机的目录")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VOLUME")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data"')]),t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volume")]),t._v(" /data/bb/tomcat/webapps")]),t._v("\n")])])]),s("h5",{attrs:{id:"env命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#env命令"}},[t._v("#")]),t._v(" env命令")]),t._v(" "),s("p",[t._v("用来为构建镜像设置环境变量。这个值将出现在构建阶段中所有后续指令的环境中。")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" <key> <value>")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" <key>=<value> ...")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("env")]),t._v(" base_dir /data/bb\t\t# 定义base_dir为目录 /data/bb")]),t._v("\ncd $base_dir\t\t\t\t# 使用时只需要在base_dir前面加上 $ 即可\n")])])]),s("h5",{attrs:{id:"cmd命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cmd命令"}},[t._v("#")]),t._v(" CMD命令")]),t._v(" "),s("p",[t._v("用来为启动的容器指定执行的命令,在Dockerfile中只能有一条CMD指令。如果列出多个命令，则只有最后一个命令才会生效，docker run中的命令可以覆盖cmd命令")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"executable"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"param1"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"param2"')]),t._v("] (exec form, this is the preferred form)CMD ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"param1"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"param2"')]),t._v("] (as default parameters to ENTRYPOINT)CMD command param1 param2 (shell form)cmd ls "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$base_dir")])]),t._v("\n")])])]),s("h5",{attrs:{id:"entrypoint命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint命令"}},[t._v("#")]),t._v(" entrypoint命令")]),t._v(" "),s("p",[t._v("用来指定容器启动时执行命令和CMD类似，但是docker run中需要加上 "),s("code",[t._v("--entrypoint")]),t._v("才能覆盖dockerfile中的命令")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[t._v('["executable", "param1", "param2"]ENTRYPOINT command param1 param2entrypoint ls $base_dir\n')])])]),s("p",[t._v("CMD与entrypoint结合，"),s("code",[t._v("entrypoint写固定命令，cmd用来传参")]),t._v("，必须使用"),s("code",[t._v("JSON数组格式")])]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[t._v('...entrypoint ["ls"]cmd ["/data/bb"]\n')])])]),s("p",[t._v("docker run加入参数如 /tomcat，就可以查看/tomcat的目录了")]),t._v(" "),s("p",[t._v("更多例子")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("entrypoint")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v("]cmd ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"demo.jar"')]),t._v("]")]),t._v("\n")])])]),s("h5",{attrs:{id:"总"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总"}},[t._v("#")]),t._v(" 总")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" centos:7run yum install -y vimexpose 3306workdir /dataenv base_dir /dataadd apache-tomcat-8.5.61.tar.gz "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$base_dirrun")]),t._v(" mv apache-tomcat-8.5.61 tomcatworkdir tomcatvolume "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$base_dir")]),t._v("/tomcat/webappsentrypoint ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ls"')]),t._v("]cmd ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/bb"')]),t._v("]")]),t._v("\n")])])]),s("h3",{attrs:{id:"dockerfile与springboot"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile与springboot"}},[t._v("#")]),t._v(" Dockerfile与SpringBoot")]),t._v(" "),s("p",[t._v("这里采用"),s("code",[t._v("jar包")]),t._v("形式打包springboot项目")]),t._v(" "),s("h5",{attrs:{id:"快速构建一个springboot项目并打成jar包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快速构建一个springboot项目并打成jar包"}},[t._v("#")]),t._v(" 快速构建一个springboot项目并打成jar包")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Controllerpublic")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HelloController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@ResponseBody")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello docker"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello docker"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("server.port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("8081")]),t._v("\n")])])]),s("h5",{attrs:{id:"拉取docker镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#拉取docker镜像"}},[t._v("#")]),t._v(" 拉取docker镜像")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull openjdk:8-jdk\n")])])]),s("h5",{attrs:{id:"服务器中创建dockerfile的上下文目录-如demo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器中创建dockerfile的上下文目录-如demo"}},[t._v("#")]),t._v(" 服务器中创建Dockerfile的上下文目录，如demo")]),t._v(" "),s("p",[t._v("mkdir demo")]),t._v(" "),s("p",[t._v("上传jar包到context目录（即demo目录）")]),t._v(" "),s("p",[t._v("vim Dockerfile")]),t._v(" "),s("div",{staticClass:"language-dockerfile extra-class"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" openjdk:8-jdkWORKDIR /appsVOLUME /appsADD demo.jar app.jarEXPOSE 8081ENTRYPOINT ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v("]CMD ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app.jar"')]),t._v("]")]),t._v("\n")])])]),s("h5",{attrs:{id:"执行构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#执行构建"}},[t._v("#")]),t._v(" 执行构建")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build -t demo:01 .Sending build context to Docker daemon  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(".08MBStep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" FROM openjdk:8-jdk ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" d61c96e2d100Step "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" WORKDIR /apps ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ed3a450344e3Removing intermediate container ed3a450344e3 ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 31998ec9f32aStep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" VOLUME /apps ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" 4a495ccb518eRemoving intermediate container 4a495ccb518e ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" e800e1889d7fStep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ADD demo.jar app.jar ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 0e8a389b3f33Step "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" EXPOSE "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v(" ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" f475eb4c420eRemoving intermediate container f475eb4c420e ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 7fa5ea1dd18fStep "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" ENTRYPOINT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(","),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" 68818bf693cdRemoving intermediate container 68818bf693cd ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 0139c42370c3Step "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("/7 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" CMD "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app.jar"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" d43c71e85460Removing intermediate container d43c71e85460 ---"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" a11972f10633Successfully built a11972f10633Successfully tagged demo:01docker imagesREPOSITORY    TAG           IMAGE ID       CREATED          SIZEdemo          01            a11972f10633   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" seconds ago   531MB\n")])])]),s("h5",{attrs:{id:"运行容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行容器"}},[t._v("#")]),t._v(" 运行容器")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v(":8081 --name demo demo:01\n")])])]),s("h5",{attrs:{id:"访问-查看日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问-查看日志"}},[t._v("#")]),t._v(" 访问，查看日志")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002914922.png",alt:""}})]),t._v(" "),s("h5",{attrs:{id:"添加新的jar包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加新的jar包"}},[t._v("#")]),t._v(" 添加新的jar包")]),t._v(" "),s("p",[t._v("添加新jar包到"),s("code",[t._v("/var/lib/docker/volumes/springboot_apps/_data")]),t._v("（配置自动映射后宿主机的位置）")]),t._v(" "),s("h5",{attrs:{id:"启动时配置映射并添加参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动时配置映射并添加参数"}},[t._v("#")]),t._v(" 启动时配置映射并添加参数")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run -d -p "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),t._v(":8081 --name demo -v springboot_apps:/apps demo:01 demo222.jar\n")])])]),s("h5",{attrs:{id:"访问并查看日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问并查看日志"}},[t._v("#")]),t._v(" 访问并查看日志")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002923612.png",alt:""}})]),t._v(" "),s("p",[t._v("有结果可知，通过参数运行指定jar包成功。")]),t._v(" "),s("h3",{attrs:{id:"idea插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#idea插件"}},[t._v("#")]),t._v(" IDEA插件")]),t._v(" "),s("h5",{attrs:{id:"docker插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker插件"}},[t._v("#")]),t._v(" Docker插件")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002933835.png",alt:""}})]),t._v(" "),s("p",[t._v("以后在IDEA中可以直接创建Dockerfile了。")]),t._v(" "),s("h5",{attrs:{id:"远程连接主机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#远程连接主机"}},[t._v("#")]),t._v(" 远程连接主机")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002942188.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002951198.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://gitee.com/yangtao8453/picgo/raw/master/img/image-20220224002959241.png",alt:""}})])])}),[],!1,null,null,null);a.default=r.exports}}]);